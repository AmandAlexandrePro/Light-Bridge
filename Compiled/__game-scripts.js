function IsString(t,e){return"string"==typeof t&&(0==e?.notEmpty||t.length>0)}function ToString(t,e){try{return 1!=IsString(t)?void 0!==t&&1!=e?.json?String(t):JSON.stringify(t):t}catch(t){if(0!=e?.default)return""}}function IsArray(t,e){try{return 1==Array.isArray(t)?0==e?.notEmpty||t.length>0:0!=e?.stringify&&(t=JSON.parse(ToString(t)),1==Array.isArray(t)&&(0==e?.notEmpty||t.length>0))}catch(t){return!1}}function ToArray(t,e){try{if(1==IsArray(t))return 1==IsString(t)?JSON.parse(t):t;if(0!=e?.default)return[]}catch(t){if(0!=e?.default)return[]}}function IsNumber(t,e){return t=Number(t),0==isNaN(t)&&(1!=e?.onlyPositive||t>0)}function ToNumber(t,e){return 1==IsNumber(t)?Number(t):0!=e?.default?0:void 0}function IsObject(t,e){try{return"object"==typeof t&&null!=t&&t?.constructor==Object?0==e?.notEmpty||Object.keys(t).length>0:0!=e?.stringify&&("object"==typeof(t=JSON.parse(ToString(t)))&&null!=t&&t?.constructor==Object&&(0==e?.notEmpty||Object.keys(t).length>0))}catch(t){return!1}}let FOV=pc.createScript("FOV");FOV.prototype.initialize=function(){const t="input[type='range'] {appearance: slider-vertical;opacity: 0.75}";let e=document.createElement("style");e.styleSheet?e.styleSheet.cssText=t:e.textContent=t,document.head.appendChild(e);let r=this.entity.findByName("Camera")?.camera;if(void 0!==r)return this.app.mouse.on(pc.EVENT_MOUSEWHEEL,(function(t){t.wheelDelta>0&&r.fov<90?r.fov+=1:t.wheelDelta<0&&r.fov>0&&(r.fov-=1)}))};let Channels=pc.createScript("Channels");Channels.attributes.add("Entities",{type:"entity",array:!0,default:["",""]}),Channels.prototype.initialize=function(){this.Entities=this.Entities.filter((function(t){return void 0!==t}));const t=this.entity.parent.name;this.input=document.createElement("input"),this.input.id=`channels_${t}`,this.input.min=0,this.input.max=100,this.input.value=this.input.min,this.input.step=1,this.input.type="range",this.input.style.position="absolute",this.input.style.border="0px",this.input.style.margin="0px",this.input.style.padding="0px",this.input.style.outline="none";let i=this.entity.root.findByName("RangeValue"),e=this.entity.parent.findByName("Led"),n=this.entity.parent.findByName("Button");if(1==(!!e&&1==e.element.enabled)&&(e.element.enabled=!1),n){let t=this.input.value;n.button.on("pressedstart",(()=>{t=this.input.value,this.input.value=this.input.max,this.input.dispatchEvent(new Event("input"))})),n.button.on("pressedend",(()=>{this.input.value=t,this.input.dispatchEvent(new Event("input"))}))}this.input.oninput=()=>{const n=this.input.value;i&&(i.element.text=n),e&&(e.element.enabled=n>0);for(let i of this.Entities){let e=i?.light;const s=void 0!==e;let p=1==s?i.parent?.script.scripts[0]:i?.script.scripts[0];if(void 0!==p){const u=(Number(t)-p.Address)%2==1?"Dimmer":"Blink";1==s?e.intensity=n/100*p.Dimmer:(p[u]=n,i.children.filter((function(t){return void 0!==t?.light})).forEach(((t,i)=>{if("Dimmer"==u){const e=document.querySelector(`#channels_${p.Address+i}`);if(1==(!!e&&e.value>0))return t.light.intensity=e.value/100*p.Dimmer}})))}}},this.on("state",(()=>this.input.style.display=1==this.entity.enabled?"block":"none")),this.updatePosition(),document.body.appendChild(this.input)},Channels.prototype.updatePosition=function(){if(this.entity.element.screenCorners){const t=this.entity.element.screenCorners,i=this.app.graphicsDevice.maxPixelRatio;this.input.style.left=t[0].x/i+"px",this.input.style.bottom=t[0].y/i+"px",this.input.style.width=(t[2].x-t[0].x)/i+"px",this.input.style.height=(t[2].y-t[0].y)/i+"px"}},Channels.prototype.update=function(){this.updatePosition()};let Scenes=pc.createScript("Scenes");Scenes.prototype.initialize=function(){const t=Number(this.entity.parent.name)-24;let e=this.entity.root.findByName("Import")?.script.scripts[0]?.Scenes;this.input=document.createElement("input"),this.input.id=`scenes_${t}`,this.input.min=0,this.input.max=100,this.input.value=this.input.min,this.input.step=1,this.input.type="range",this.input.style.position="absolute",this.input.style.border="0px",this.input.style.margin="0px",this.input.style.padding="0px",this.input.style.outline="none",this.entity.script.scripts[0];let i=this.entity.root.findByName("RangeValue")?.element,n=this.entity.parent.findByName("Led")?.element,s=this.entity.parent.findByName("Button")?.button,o=this.app.root.findByName("Recording")?.script.scripts[0],r=this.entity.parent.findByName("Record")?.element;if(void 0!==n&&void 0!==s&&"number"==typeof o?.Index&&void 0!==i&&void 0!==r){n.enabled=!1;let p=this.input.value;s.on("pressedstart",(()=>{o.Index<0&&(p=this.input.value,this.input.value=this.input.max,this.input.dispatchEvent(new Event("input")))})),s.on("pressedend",(()=>{o.Index<0&&(this.input.value=p,this.input.dispatchEvent(new Event("input")))})),s.on("click",(()=>{o.Index==t||0==o.Index&&(o.Index=t,globalThis.recordScene=[],r.enabled=!0,Interval=setInterval((function(){return r.enabled=!r.enabled}),700))})),this.input.oninput=async()=>{const s=this.input.value;if(i.text=s,n.enabled=s>0,globalThis?.Inter!=t){let i=e?.resource?.Scenes?.[t-1];if(1==IsObject(i)){i=Object.entries(i);const e=this.app.root.children[0].children;let n={};globalThis.Inter=t,async function Interval(s){if(globalThis.Inter==t&&this.value>0){for(let[t,o]of i){"number"!=typeof n?.[t]&&(n[t]=o.length-1);for(const i of e.filter((function(e){return 1==e.name.endsWith(t)}))){let t=i?.script.scripts[0];if(void 0!==t){const e=o[s];if(1==IsObject(e)){const n=e?.Dimmer;t.Dimmer="number"==typeof n?n/100*this.value:this.value;for(const[n,s]of Object.entries(e).filter((function([t]){return 1==["Dimmer","Blink"].every((function(e){return e!=t}))}))){let e=i.findByName(n)?.light;void 0!==e&&(e.intensity=s/100*this.value/100*t.Dimmer)}}}}}return await new Promise((function(t,e){try{return setTimeout(t,750)}catch(t){return e(t)}})),await Interval.bind(this)(s==Math.max(...Object.entries(n).map((function([,t]){return t})))?0:s+1)}globalThis.Inter==t&&(globalThis.Inter=void 0)}.bind(this.input)(0)}}}}this.on("state",(()=>this.input.style.display=1==this.entity.enabled?"block":"none")),this.updatePosition(),document.body.appendChild(this.input)},Scenes.prototype.updatePosition=function(){if(this.entity.element.screenCorners){const t=this.entity.element.screenCorners,e=this.app.graphicsDevice.maxPixelRatio;this.input.style.left=t[0].x/e+"px",this.input.style.bottom=t[0].y/e+"px",this.input.style.width=(t[2].x-t[0].x)/e+"px",this.input.style.height=(t[2].y-t[0].y)/e+"px"}},Scenes.prototype.update=function(){this.updatePosition()};let Import=pc.createScript("Import");Import.attributes.add("Scenes",{type:"asset",assetType:"json"}),Import.prototype.initialize=function(){this.set(this.Scenes.resource),this.entity.button.on("click",(()=>{let e=document.createElement("input");e.type="file",e.accept="application/json",e.style.display="none",e.addEventListener("change",(t=>{let r=t.target.files[0];if(r){let t=new FileReader;t.onload=t=>{try{this.set(JSON.parse(t.target.result))}catch(e){}finally{e.remove()}},t.readAsText(r)}}),{once:!0}),document.body.appendChild(e),e.click()}))},Import.prototype.set=function(e){let t=e?.Scenes;if(1==IsArray(t)){let e=[];for(const r of t.filter((function(e){return 1==IsObject(e)}))){let t={};for(const e of["Left","Center","Right"])for(const n of ToArray(r?.[e]).filter((function(e){return 1==IsObject(e)}))){let r=new Map;for(const e of["Red","Green","Blue","White","Amber","Dimmer","Blink"]){let t=ToNumber(n?.[e],{default:!1});1==(1==IsNumber(t)&&(t>=0&&t<=100))&&r.set(e,t)}if(r.size>0){let n={};1!=Array.isArray(t[e])&&(t[e]=[]);for(const[e,t]of r)n[e]=t;t[e].push(n)}}1==IsObject(t)&&e.push(t)}1==IsArray(e)&&(e=e.slice(0,23),this.Scenes.resource={Scenes:e},this.app.root.findByName("Scenes").children.forEach((t=>{const r=Number(t.name)-25;let n=t.findByName("Record")?.element;void 0!==n&&(n.enabled=void 0!==e?.[r])})))}};let Toggle=pc.createScript("Toggle");Toggle.prototype.initialize=function(){Console=this.entity.parent.findByName("Console"),Console&&(Import=Console.parent.findByName("Import"),Export=Console.parent.findByName("Export"),1==Console.enabled&&(Console.enabled=!1),Import&&Export&&(Import.element.enabled=Console.enabled,Export.element.enabled=Console.enabled,this.entity.button.on("click",(()=>{1==Console.enabled?(this.entity.element.textureAsset=this.app.assets.find("open.png","texture")?.id,Console.enabled=!1,Import.element.enabled=Console.enabled,Export.element.enabled=Console.enabled):(this.entity.element.textureAsset=this.app.assets.find("close.png","texture")?.id,Console.enabled=!0,Import.element.enabled=Console.enabled,Export.element.enabled=Console.enabled)}))))};let RangeSlider=pc.createScript("Range");let Views=pc.createScript("Views");Views.prototype.initialize=function(){let t=this.app.root.findComponents("element").filter((function(t){return"Projector"==t.entity.name}));if(t.length>0){for(let{entity:e}of t){let t=e.findByName("Address")?.element;if("string"==typeof t?.text){let n=Number(e.parent?.script.scripts[0].Address)?.toString();t.text=void 0!==n?t.text.substring(0,t.text.length-n.length)+n:"????"}1==e.enabled&&(e.enabled=!1)}return this.entity.button.on("click",(function(){for(let{entity:e}of t)e.enabled=!e.enabled}))}};let Projectors=pc.createScript("Projectors");Projectors.attributes.add("Address",{type:"number"}),Projectors.attributes.add("Dimmer",{type:"number",default:0,min:0,max:100}),Projectors.attributes.add("Blink",{type:"number",default:0,min:0,max:100});let Export=pc.createScript("Export");Export.prototype.initialize=function(){let t=this.entity.parent.findByName("Import")?.script.scripts[0]?.Scenes;void 0!==t&&this.entity.button.on("click",(()=>{let e=document.createElement("a");e.href=`data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(t.resource))}`,e.download="scenes.json",e.style.display="none",document.body.appendChild(e),e.click(),e.remove()}))};let Recording=pc.createScript("Recording");Recording.attributes.add("Index",{type:"number",default:-1,min:-1,max:24}),Recording.prototype.initialize=function(){let e=this.entity.findByName("Led")?.element,t=this.entity.findByName("Button")?.button;if(void 0!==e&&void 0!==t){let n;return t.on("click",(()=>{this.Index<0?(this.Index=0,e.enabled=!1,n=setInterval((function(){return e.enabled=!e.enabled}),700)):this.Index>0&&(this.Index=-1,void 0!==n&&clearInterval(n),e.enabled=!0)}))}};let Steps=pc.createScript("Steps");Steps.prototype.initialize=function(){setInterval((()=>this.entity.element.enabled=!this.entity.element.enabled),750)};